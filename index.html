<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Machine Learning and Data Science">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Machine Learning and Data Science">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Machine Learning and Data Science">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Machine Learning and Data Science</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Machine Learning and Data Science</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/15/Complex-Datatypes-in-Hive/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yifan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/author.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Machine Learning and Data Science">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/15/Complex-Datatypes-in-Hive/" itemprop="url">Complex Datatypes in Hive</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-15T12:03:04+12:00">
                2018-07-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Hadoop/" itemprop="url" rel="index">
                    <span itemprop="name">Hadoop</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><p>Hive has three main complex types <strong>ARRAY</strong>, <strong>MAP</strong>, and <strong>STRUCT</strong>.</p>
<table>
<thead>
<tr>
<th>Datatype</th>
<th>Description</th>
<th>Define</th>
<th>Access</th>
</tr>
</thead>
<tbody>
<tr>
<td>ARRAY</td>
<td>This is a list of items of the same type, such as an ordered list of strings or an ordered list of integers.</td>
<td>work_place ARRAY&lt;STRING&gt;</td>
<td>work_place[0]</td>
</tr>
<tr>
<td>MAP</td>
<td>This is a set of key-value pairs.</td>
<td>skills_score MAP&lt;STRING,INT&gt;</td>
<td>skills_score[‘DB’]</td>
</tr>
<tr>
<td>STRUCT</td>
<td>This is a user-defined structure of any type of field.</td>
<td>gender_age STRUCT&lt;gender:STRING,age:INT&gt;</td>
<td>gender_age.gender</td>
</tr>
</tbody>
</table>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><ul>
<li><p>Prepare the data as follows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$vi employee.txt</span><br><span class="line">Michael|Montreal,Toronto|Male,30|DB:80|Product:Developer^DLead</span><br><span class="line">Will|Montreal|Male,35|Perl:85|Product:Lead,Test:Lead</span><br><span class="line">Shelley|New York|Female,27|Python:80|Test:Lead,COE:Architect</span><br><span class="line">Lucy|Vancouver|Female,57|Sales:89,HR:94|Sales:Lead</span><br></pre></td></tr></table></figure>
</li>
<li><p>Load the local file to HDFS</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -copyFromLocal employee.txt /user/hive/warehouse</span><br></pre></td></tr></table></figure>
</li>
<li><p>Connect to Hive</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">beeline -u &quot;jdbc:hive2://localhost:10000/default&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create the table in Hive:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE employee (</span><br><span class="line">      name STRING,</span><br><span class="line">      work_place ARRAY&lt;STRING&gt;,</span><br><span class="line">      gender_age STRUCT&lt;gender:STRING,age:INT&gt;,</span><br><span class="line">      skills_score MAP&lt;STRING,INT&gt;,</span><br><span class="line">      depart_title MAP&lt;STRING,ARRAY&lt;STRING&gt;&gt;</span><br><span class="line">  )</span><br><span class="line">  ROW FORMAT DELIMITED</span><br><span class="line">  FIELDS TERMINATED BY &apos;|&apos;</span><br><span class="line">  COLLECTION ITEMS TERMINATED BY &apos;,&apos;</span><br><span class="line">  MAP KEYS TERMINATED BY &apos;:&apos;</span><br><span class="line">  STORED AS TEXTFILE;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Verify table structure</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">describe employee;</span><br><span class="line"></span><br><span class="line">+---------------+--------------------------------+----------+--+</span><br><span class="line">|   col_name    |           data_type            | comment  |</span><br><span class="line">+---------------+--------------------------------+----------+--+</span><br><span class="line">| name          | string                         |          |</span><br><span class="line">| work_place    | array&lt;string&gt;                  |          |</span><br><span class="line">| gender_age    | struct&lt;gender:string,age:int&gt;  |          |</span><br><span class="line">| skills_score  | map&lt;string,int&gt;                |          |</span><br><span class="line">| depart_title  | map&lt;string,array&lt;string&gt;&gt;      |          |</span><br><span class="line">+---------------+--------------------------------+----------+--+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Load the data into table</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOAD DATA INPATH &apos;/user/hive/warehouse/employee.txt&apos; OVERWRITE INTO TABLE employee;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Verify records in the data</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select * from employee;</span><br><span class="line"></span><br><span class="line">+----------------+-------------------------+-------------------------------+------------------------+----------------------------------------+--+</span><br><span class="line">| employee.name  |   employee.work_place   |      employee.gender_age      | employee.skills_score  |         employee.depart_title          |</span><br><span class="line">+----------------+-------------------------+-------------------------------+------------------------+----------------------------------------+--+</span><br><span class="line">| Michael        | [&quot;Montreal&quot;,&quot;Toronto&quot;]  | &#123;&quot;gender&quot;:&quot;Male&quot;,&quot;age&quot;:30&#125;    | &#123;&quot;DB&quot;:80&#125;              | &#123;&quot;Product&quot;:[&quot;Developer, Lead&quot;]&#125;        |</span><br><span class="line">| Will           | [&quot;Montreal&quot;]            | &#123;&quot;gender&quot;:&quot;Male&quot;,&quot;age&quot;:35&#125;    | &#123;&quot;Perl&quot;:85&#125;            | &#123;&quot;Product&quot;:[&quot;Lead&quot;],&quot;Test&quot;:[&quot;Lead&quot;]&#125;   |</span><br><span class="line">| Shelley        | [&quot;New York&quot;]            | &#123;&quot;gender&quot;:&quot;Female&quot;,&quot;age&quot;:27&#125;  | &#123;&quot;Python&quot;:80&#125;          | &#123;&quot;Test&quot;:[&quot;Lead&quot;],&quot;COE&quot;:[&quot;Architect&quot;]&#125;  |</span><br><span class="line">| Lucy           | [&quot;Vancouver&quot;]           | &#123;&quot;gender&quot;:&quot;Female&quot;,&quot;age&quot;:57&#125;  | &#123;&quot;Sales&quot;:89,&quot;HR&quot;:94&#125;   | &#123;&quot;Sales&quot;:[&quot;Lead&quot;]&#125;                     |</span><br><span class="line">+----------------+-------------------------+-------------------------------+------------------------+----------------------------------------+--+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Access ARRAY</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT work_place[0] as col_1, work_place[1] as col_2, work_place[2] as col_3 FROM employee;</span><br><span class="line"></span><br><span class="line">+------------+----------+--------+--+</span><br><span class="line">|   col_1    |  col_2   | col_3  |</span><br><span class="line">+------------+----------+--------+--+</span><br><span class="line">| Montreal   | Toronto  | NULL   |</span><br><span class="line">| Montreal   | NULL     | NULL   |</span><br><span class="line">| New York   | NULL     | NULL   |</span><br><span class="line">| Vancouver  | NULL     | NULL   |</span><br><span class="line">+------------+----------+--------+--+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Access STRUCT</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT gender_age.gender, gender_age.age FROM employee;</span><br><span class="line"></span><br><span class="line">+---------+------+--+</span><br><span class="line">| gender  | age  |</span><br><span class="line">+---------+------+--+</span><br><span class="line">| Male    | 30   |</span><br><span class="line">| Male    | 35   |</span><br><span class="line">| Female  | 27   |</span><br><span class="line">| Female  | 57   |</span><br><span class="line">+---------+------+--+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Access MAP</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SELECT name,</span><br><span class="line">       skills_score[&apos;DB&apos;] as DB, </span><br><span class="line">       skills_score[&apos;Perl&apos;] as Perl,</span><br><span class="line">       skills_score[&apos;Python&apos;] as Python, </span><br><span class="line">       skills_score[&apos;Sales&apos;] as Sales,</span><br><span class="line">       skills_score[&apos;HR&apos;] as HR</span><br><span class="line">       FROM employee;</span><br><span class="line">       </span><br><span class="line">+----------+-------+-------+---------+--------+-------+--+</span><br><span class="line">|   name   |  db   | perl  | python  | sales  |  hr   |</span><br><span class="line">+----------+-------+-------+---------+--------+-------+--+</span><br><span class="line">| Michael  | 80    | NULL  | NULL    | NULL   | NULL  |</span><br><span class="line">| Will     | NULL  | 85    | NULL    | NULL   | NULL  |</span><br><span class="line">| Shelley  | NULL  | NULL  | 80      | NULL   | NULL  |</span><br><span class="line">| Lucy     | NULL  | NULL  | NULL    | 89     | 94    |</span><br><span class="line">+----------+-------+-------+---------+--------+-------+--+</span><br></pre></td></tr></table></figure>
</li>
<li><p>Access ARRAY in MAP</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT name, </span><br><span class="line">       depart_title[&apos;Product&apos;][0] as product_col0, </span><br><span class="line">       FROM employee;</span><br></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/14/Impala-SQL-Statement/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yifan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/author.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Machine Learning and Data Science">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/14/Impala-SQL-Statement/" itemprop="url">Impala SQL Statement</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-14T17:43:57+12:00">
                2018-07-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Hadoop/" itemprop="url" rel="index">
                    <span itemprop="name">Hadoop</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Create-database"><a href="#Create-database" class="headerlink" title="Create database"></a>Create database</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE database IF NOT EXISTS &lt;database_name&gt;;</span><br><span class="line">USE &lt;database_name&gt;;</span><br></pre></td></tr></table></figure>
<p>An impala database is created inside the Impala directory on HDFS with the name _database_name.db_.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[cloudera@quickstart ~]$ hadoop fs -ls /user/hive/warehouse</span><br><span class="line">Found 10 items</span><br><span class="line">drwxrwxrwx   - cloudera supergroup          0 2018-07-06 03:05 /user/hive/warehouse/categories</span><br><span class="line">drwxrwxrwx   - impala   supergroup          0 2018-07-14 01:57 /user/hive/warehouse/my_database.db</span><br></pre></td></tr></table></figure></p>
<h3 id="Create-table"><a href="#Create-table" class="headerlink" title="Create table"></a>Create table</h3><ul>
<li><p>Explicit column definitions </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS customer( </span><br><span class="line">customer_id	INT,	 </span><br><span class="line">customer_firstname STRING,	 </span><br><span class="line">customer_lastname STRING	 </span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create table as select</p>
<p>  Clone the structure of a table and transfer data into it.</p>
<ul>
<li><p>clone a table</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE customer_clone AS SELECT * FROM customer;</span><br></pre></td></tr></table></figure>
</li>
<li><p>copy only some rows</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE customer_part AS SELECT * FROM customer WHERE customer_id&lt;=2;</span><br></pre></td></tr></table></figure>
</li>
<li><p>clone the table and convert to a different format</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE customer_parquet stored AS parquet AS SELECT * FROM customer;</span><br><span class="line">``` </span><br><span class="line">* Rename and reorder columns</span><br><span class="line">```commandline</span><br><span class="line">CREATE TABLE customer_new AS </span><br><span class="line">SELECT customer_id+1 AS id, UPPER(customer_lastname) AS lastname,</span><br><span class="line">UPPER(customer_firstname) AS firstname FROM customer;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Create table like</p>
<p>  Create an empty table with the same structure as another table.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE customer_empty_clone LIKE customer;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create external table<br>  The tables created are internal tables by default. They are managed by Impala. External table use arbitrary HDFS directories, where the data files are typically shared between different Hadoop components. Impala leaves the data files in place when you drop the table</p>
<ul>
<li><p>Create table stored in different format</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE EXTERNAL TABLE external_parquet (c1 INT, c2 STRING, c3 TIMESTAMP) </span><br><span class="line">STORED AS PARQUET LOCATION &apos;/user/tests&apos;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create table with different delimiter character</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS customer_text( </span><br><span class="line">customer_id	INT,	 </span><br><span class="line">customer_firstname STRING,	 </span><br><span class="line">customer_lastname STRING</span><br><span class="line">)</span><br><span class="line">ROW FORMAT DELIMITED FIELDS TERMINATED BY &apos;,&apos; STORED AS TEXTFILE</span><br><span class="line">LOCATION &apos;/user/tests/customer.txt&apos;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li>Check the files in HDFS<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[cloudera@quickstart ~]$ hadoop fs -ls /user/hive/warehouse/my_database.db</span><br><span class="line">Found 6 items</span><br><span class="line">drwxrwxrwx   - impala supergroup          0 2018-07-14 00:37 /user/hive/warehouse/my_database.db/customer_clone</span><br><span class="line">drwxrwxrwx   - impala supergroup          0 2018-07-14 01:06 /user/hive/warehouse/my_database.db/customer_like</span><br><span class="line">drwxrwxrwx   - impala supergroup          0 2018-07-14 01:12 /user/hive/warehouse/my_database.db/customer_new</span><br><span class="line">drwxrwxrwx   - impala supergroup          0 2018-07-14 00:56 /user/hive/warehouse/my_database.db/customer_parquet</span><br><span class="line">drwxrwxrwx   - impala supergroup          0 2018-07-14 00:53 /user/hive/warehouse/my_database.db/customer_part</span><br><span class="line">drwxrwxrwx   - impala supergroup          0 2018-07-14 00:35 /user/hive/warehouse/my_database.db/customer</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Insert-rows"><a href="#Insert-rows" class="headerlink" title="Insert rows"></a>Insert rows</h3><ul>
<li><p>Explicit value </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO TABLE customer VALUES (1, &apos;Mary&apos;, &apos;Graze&apos;), (2, &apos;Yong&apos;, &apos;Que&apos;), (3, &apos;Sarah&apos;, &apos;Han&apos;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Insert table select</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO TABLE customer_like select * FROM customer;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Insert overwrite</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT OVERWRITE TABLE customer_like select * FROM customer LIMIT 3;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Alter-table"><a href="#Alter-table" class="headerlink" title="Alter table"></a>Alter table</h3><ul>
<li><p>Add, drop, change columns</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE customer ADD COLUMNS (address STRING, age TINYINT, gender BOOLEAN);</span><br><span class="line">ALTER TABLE customer DROP COLUMN address;</span><br><span class="line">ALTER TABLE customer CHANGE age customer_age SMALLINT;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Rename a table</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE customer RENAME TO v1_customer;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>For internal tables, this operation physically renames the directory within HDFS that contains the data files; the original directory name no longer exists.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[cloudera@quickstart ~]$ hadoop fs -ls /user/hive/warehouse/my_database.db</span><br><span class="line">Found 6 items</span><br><span class="line">drwxrwxrwx   - impala supergroup          0 2018-07-14 00:37 /user/hive/warehouse/my_database.db/customer_clone</span><br><span class="line">drwxrwxrwx   - impala supergroup          0 2018-07-14 01:06 /user/hive/warehouse/my_database.db/customer_like</span><br><span class="line">drwxrwxrwx   - impala supergroup          0 2018-07-14 01:12 /user/hive/warehouse/my_database.db/customer_new</span><br><span class="line">drwxrwxrwx   - impala supergroup          0 2018-07-14 00:56 /user/hive/warehouse/my_database.db/customer_parquet</span><br><span class="line">drwxrwxrwx   - impala supergroup          0 2018-07-14 00:53 /user/hive/warehouse/my_database.db/customer_part</span><br><span class="line">drwxrwxrwx   - impala supergroup          0 2018-07-14 00:35 /user/hive/warehouse/my_database.db/v1_customer</span><br></pre></td></tr></table></figure></p>
<p>For external tables, to change the physical location where Impala looks for data files associated with a table:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE external_parquet SET LOCATION &apos;/user/test1&apos;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>Change file format<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE v1_customer SET FILEFORMAT PARQUET;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Load-data"><a href="#Load-data" class="headerlink" title="Load data"></a>Load data</h3><ul>
<li><p>Load data from HDFS files into Impala tables.<br>The loaded file <code>test.txt</code> is moved from HDFS to the Impala data directory.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE t1(s STRINT);</span><br><span class="line">LOAD DATA INPATH &apos;/user/hive/warehouse/test.txt&apos; INTO TABLE t1;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Load data from local into Impala tables.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOAD DATA LOCAL INPATH &apos;/home/cloudera/test.txt&apos; OVERWRITE INTO TABLE t1;</span><br></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/14/Impala-Shell-Commands-General/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yifan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/author.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Machine Learning and Data Science">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/14/Impala-Shell-Commands-General/" itemprop="url">Impala Shell Commands - General commands</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-14T15:25:35+12:00">
                2018-07-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Hadoop/" itemprop="url" rel="index">
                    <span itemprop="name">Hadoop</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Help"><a href="#Help" class="headerlink" title="Help"></a>Help</h3><ul>
<li><p>Press <code>Tab</code> twice to see all the commands.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[quickstart.cloudera:21000] &gt; </span><br><span class="line">alter     desc      help      quit      show      unset     version</span><br><span class="line">compute   describe  history   rerun     source    update    with</span><br><span class="line">connect   drop      insert    select    src       upsert    </span><br><span class="line">create    exit      load      set       summary   use       </span><br><span class="line">delete    explain   profile   shell     tip       values</span><br></pre></td></tr></table></figure>
</li>
<li><p>Detail information about a command.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">help &lt;command_name&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Refresh-metadata"><a href="#Refresh-metadata" class="headerlink" title="Refresh metadata"></a>Refresh metadata</h3><p>Impala does not poll constantly for metadata changes. We must tell Impala that its metadata is out of date.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">invalidate metadata;</span><br></pre></td></tr></table></figure></p>
<h3 id="Show"><a href="#Show" class="headerlink" title="Show"></a>Show</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br><span class="line">show tables like &apos;*a*&apos;;</span><br><span class="line">show tables in &lt;database_name&gt; like &apos;*a*|b*&apos;;</span><br></pre></td></tr></table></figure>
<h3 id="Use"><a href="#Use" class="headerlink" title="Use"></a>Use</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use &lt;database_name&gt;;</span><br></pre></td></tr></table></figure>
<h3 id="Describe"><a href="#Describe" class="headerlink" title="Describe"></a>Describe</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">describe database &lt;database_name&gt;;</span><br><span class="line">describe &lt;table_name&gt;;  # current database</span><br><span class="line">describe &lt;database.name&gt;.&lt;table_name&gt; # specify a database</span><br></pre></td></tr></table></figure>
<h3 id="Set-Unset"><a href="#Set-Unset" class="headerlink" title="Set/Unset"></a>Set/Unset</h3><ul>
<li><p>display and set the current query option</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set; </span><br><span class="line">set [query_option=value];</span><br></pre></td></tr></table></figure>
</li>
<li><p>specify substitution variables</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set var:varname=value </span><br><span class="line">unset var:varname;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h3><p>Provide an execution plan of a query.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain &lt;query&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="Profile"><a href="#Profile" class="headerlink" title="Profile"></a>Profile</h3><p>Get low-level information on the last processed query.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">profile;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/14/Impala-Shell-Command-Options/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yifan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/author.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Machine Learning and Data Science">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/14/Impala-Shell-Command-Options/" itemprop="url">Impala Shell Command Options</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-14T12:10:38+12:00">
                2018-07-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Hadoop/" itemprop="url" rel="index">
                    <span itemprop="name">Hadoop</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Connection"><a href="#Connection" class="headerlink" title="Connection"></a>Connection</h3><ul>
<li>To connect during shell startup<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">impala-shell -i host:port</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>port number is 21000 by default</p>
<ul>
<li>To connect after shell startup<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">impala-shell</span><br><span class="line">connect host:port</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Run-query-outside-the-shell"><a href="#Run-query-outside-the-shell" class="headerlink" title="Run query outside the shell"></a>Run query outside the shell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">impala-shell -i localhost -d &lt;database_name&gt; -q &apos;show tables&apos;</span><br></pre></td></tr></table></figure>
<h3 id="Run-queries-in-a-file"><a href="#Run-queries-in-a-file" class="headerlink" title="Run queries in a file"></a>Run queries in a file</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">impala-shell -i localhost -d &lt;database_name&gt; -f /&lt;path&gt;/myfile.sql&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Store-result-in-a-file"><a href="#Store-result-in-a-file" class="headerlink" title="Store result in a file"></a>Store result in a file</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">impala-shell -q &apos;&lt;query&gt;&apos; -B --output_delimiter=&apos;,&apos; -o output.csv</span><br></pre></td></tr></table></figure>
<h3 id="Help"><a href="#Help" class="headerlink" title="Help"></a>Help</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">impala-shell -h</span><br></pre></td></tr></table></figure>
<h3 id="Check-version-information"><a href="#Check-version-information" class="headerlink" title="Check version information"></a>Check version information</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">impala-shell -v</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/13/Avro-vs-Parquet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yifan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/author.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Machine Learning and Data Science">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/13/Avro-vs-Parquet/" itemprop="url">Avro vs Parquet</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-13T20:59:35+12:00">
                2018-07-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Hadoop/" itemprop="url" rel="index">
                    <span itemprop="name">Hadoop</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Avro and Parquet are two file formats in Hadoop.</p>
<h3 id="Avro"><a href="#Avro" class="headerlink" title="Avro"></a>Avro</h3><ul>
<li>Row-based format. When reading data from disk, Avro reads each row.</li>
<li>Avro stores the data definition in JSON format, the data itself is stored in binary format.</li>
<li>Avro is designed to be language-independent (can be read across many languages)</li>
<li>Avro supports schema evolution (schema can change over time)</li>
<li><p>Avro supports compression, such as Snappy</p>
<ul>
<li>Snappy is faster</li>
<li><p>Deflate is slightly more compact.</p>
<p>In Sqoop 1, the command line is as following</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--compression-codec=snappy \</span><br><span class="line">--as-avrodatafile \</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="Parquet"><a href="#Parquet" class="headerlink" title="Parquet"></a>Parquet</h3><ul>
<li>Column-based format. When reading data from disk. A query can examine and perform calculations on all values for a column while reading only a small fraction of the data from a data file or table.</li>
<li><p>Supports compression.</p>
<p>In Sqoop 1, the command line is as following</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--compression-codec=snappy \</span><br><span class="line">--as-parquetfile \</span><br></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/08/Impala-Overview/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yifan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/author.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Machine Learning and Data Science">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/08/Impala-Overview/" itemprop="url">Impala Overview</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-08T23:50:17+12:00">
                2018-07-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Hadoop/" itemprop="url" rel="index">
                    <span itemprop="name">Hadoop</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="What-is-Impala"><a href="#What-is-Impala" class="headerlink" title="What is Impala?"></a>What is Impala?</h3><ul>
<li>Impala is a MPP(Massive Parallel Processing) SQL query engine.</li>
<li>Impala provides fast, interactive SQL queries directly on your Apache Hadoop data stored in HDFS, HBase, or the Amazon Simple Storage Service (S3).</li>
<li>Impala also uses the same metadata, SQL syntax (Hive SQL), ODBC driver, and user interface (Impala query UI in Hue) as Apache Hive</li>
<li>Impala does not replace the batch processing frameworks built on MapReduce such as Hive.</li>
</ul>
<p><a href="https://impala.apache.org/docs/build3x/html/topics/impala_intro.html" target="_blank" rel="noopener">From Impala docs</a></p>
<h3 id="Impala-core-components"><a href="#Impala-core-components" class="headerlink" title="Impala core components"></a>Impala core components</h3><ul>
<li><strong>Impala daemon</strong> - A process named <em>impalad</em> runs on each DataNode where impala is installed. It is responsible for processing the queries.</li>
<li><strong>Impala statestore</strong> - Responsible for checking the health of each <em>impalad</em>, and then relaying each <em>impalad</em> health to others frequently.</li>
<li><strong>Impala metadata and metastore</strong>: Stores the information about the data available in Impala, such as the structure and tables.</li>
</ul>
<h3 id="Interface-of-Impala"><a href="#Interface-of-Impala" class="headerlink" title="Interface of Impala"></a>Interface of Impala</h3><ul>
<li>Impala Shell </li>
<li>Hue</li>
<li>ODBC clients, JDBC clients</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/07/Sqoop/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yifan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/author.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Machine Learning and Data Science">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/07/Sqoop/" itemprop="url">Sqoop</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-07T16:02:19+12:00">
                2018-07-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Hadoop/" itemprop="url" rel="index">
                    <span itemprop="name">Hadoop</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="What-is-Sqool"><a href="#What-is-Sqool" class="headerlink" title="What is Sqool?"></a>What is Sqool?</h3><p>Sqoop is a tool used to transfer data between Hadoop and relational database such as MySQL or Oracle.<br>With Sqoop, you can import tables from a RDBMS into HDFS.</p>
<h3 id="How-does-it-work"><a href="#How-does-it-work" class="headerlink" title="How does it work?"></a>How does it work?</h3><p>The input to the import process is tables in databases. And Sqoop processes the data in the following two stages:</p>
<ol>
<li>Sqoop fetches the metadata of the table, including the primary key, names of column, number of rows</li>
<li>Sqoop submits map jobs only without reduce, because we just want to fetch the raw data.<br>This process is performed in parallel. For example, there are 100 rows in a table and 4 mappers, then each mapper will fetch 25 rows. These 4 mapper tasks will work in parallel to achieve high performance.</li>
</ol>
<p>The output of the import process is a set of files (delimited text with comma by default).<br>The number of files is equal to the number of mappers used by Sqoop. In above example, we will have 4 output files in HDFS.</p>
<p>Sqoop can also export the data from HDFS back to RDBMS.</p>
<h3 id="Import"><a href="#Import" class="headerlink" title="Import"></a>Import</h3><ul>
<li>Import all tables</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sqoop import-all-tables \</span><br><span class="line">    -m &lt;number of map tasks&gt; \</span><br><span class="line">    --connect jdbc:mysql://&lt;host&gt;:3306/&lt;database-name&gt; \</span><br><span class="line">    --username=&lt;username&gt; \</span><br><span class="line">    --password=&lt;password&gt; \</span><br><span class="line">    --warehouse-dir=&lt;parent for table destination&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>Import a single table</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line">    --connect jdbc:mysql://&lt;host&gt;:3306/&lt;database-name&gt; \</span><br><span class="line">    --username=&lt;username&gt; \</span><br><span class="line">    --password=&lt;password&gt; \</span><br><span class="line">    --table &lt;table-name&gt; \</span><br><span class="line">    --target-dir &lt;dir for table in HDFS&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>Import partial table</p>
<ul>
<li><p>select rows</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line">    --connect jdbc:mysql://&lt;host&gt;:3306/&lt;database-name&gt;  \</span><br><span class="line">    --username=&lt;username&gt; \</span><br><span class="line">    --password=&lt;password&gt; \</span><br><span class="line">    --table &lt;table-name&gt; \</span><br><span class="line">    --where &quot;&lt;condition&gt;&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>select column</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line">    --connect jdbc:mysql://&lt;host&gt;:3306/&lt;database-name&gt;  \</span><br><span class="line">    --username=&lt;username&gt; \</span><br><span class="line">    --password=&lt;password&gt; \</span><br><span class="line">    --table &lt;table-name&gt; \</span><br><span class="line">    --columns &quot;&lt;col1,col2,…&gt;&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>free form query</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line">    --connect jdbc:mysql://&lt;host&gt;:3306/&lt;database-name&gt;  \</span><br><span class="line">    --username=&lt;username&gt; \</span><br><span class="line">    --password=&lt;password&gt; \</span><br><span class="line">    --query &apos;SELECT a.*, b.* FROM a JOIN b on (a.id == b.id) WHERE $CONDITIONS&apos; \</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Import into Hive in compressed Parquet format</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sqoop import-all-tables \</span><br><span class="line">    --connect jdbc:mysql://&lt;host&gt;:3306/&lt;database-name&gt; \</span><br><span class="line">    --username=&lt;username&gt; \</span><br><span class="line">    --password=&lt;password&gt; \</span><br><span class="line">    --warehouse-dir=&lt;parent for table destination&gt;</span><br><span class="line">    --compression-codec=snappy \</span><br><span class="line">    --as-parquetfile \</span><br><span class="line">    --hive-import</span><br></pre></td></tr></table></figure>
<h3 id="Export"><a href="#Export" class="headerlink" title="Export"></a>Export</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sqoop export \</span><br><span class="line">    --connect jdbc:mysql://&lt;host&gt;:3306/&lt;database-name&gt;  \</span><br><span class="line">    --username=&lt;username&gt; \</span><br><span class="line">    --password=&lt;password&gt; \</span><br><span class="line">    --export-dir &lt;HDFS source path&gt; \ </span><br><span class="line">    --table &lt;table-name&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Jobs"><a href="#Jobs" class="headerlink" title="Jobs"></a>Jobs</h3><ul>
<li>Create a job</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqoop job \</span><br><span class="line">    -- create &lt;job_name&gt; \ </span><br><span class="line">    -- import \</span><br><span class="line">    &lt;import arguments&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>Show a job</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqoop job -- show &lt;job_name&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Execute a job</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqoop job -- exec &lt;job_name&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>List all jobs</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqoop job -- list</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="How-to-access-the-output-files"><a href="#How-to-access-the-output-files" class="headerlink" title="How to access the output files?"></a>How to access the output files?</h3><p>Once the import complete, we can confirm that the data was imported into HDFS.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -ls /&lt;HDFS path&gt;</span><br><span class="line">hadoop fs -cat /&lt;HDFS path&gt;/&lt;table-name&gt;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/02/AWS-Elastic-Block-Storage-EBS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yifan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/author.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Machine Learning and Data Science">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/02/AWS-Elastic-Block-Storage-EBS/" itemprop="url">AWS-Elastic Block Storage(EBS)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-02T12:43:50+12:00">
                2018-07-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AWS/" itemprop="url" rel="index">
                    <span itemprop="name">AWS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>The EBS storage service is delivered in volumes, which can be attached to an EC2 instance and used just like a disk drive. The EC2 instance must be located within the same availability zones as the EBS volume. To access the volume, we must format it and then mount it to the instance filesystem.</p>
<h3 id="List-block-devices"><a href="#List-block-devices" class="headerlink" title="List block devices"></a>List block devices</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-172-31-90-214 ~]$ lsblk</span><br><span class="line">NAME    MAJ:MIN RM SIZE RO TYPE MOUNTPOINT</span><br><span class="line">xvda    202:0    0   8G  0 disk</span><br><span class="line">└─xvda1 202:1    0   8G  0 part /</span><br><span class="line">xvdb    202:16   0   8G  0 disk</span><br></pre></td></tr></table></figure>
<h3 id="Create-a-filesystem"><a href="#Create-a-filesystem" class="headerlink" title="Create a filesystem"></a>Create a filesystem</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-172-31-90-214 ~]$ sudo mke2fs /dev/xvdb</span><br><span class="line">mke2fs 1.42.12 (29-Aug-2014)</span><br><span class="line">Creating filesystem with 2097152 4k blocks and 524288 inodes</span><br><span class="line">Filesystem UUID: b6175fcc-1668-416b-a613-ac57909019e0</span><br><span class="line">Superblock backups stored on blocks:</span><br><span class="line">        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632</span><br><span class="line"></span><br><span class="line">Allocating group tables: done</span><br><span class="line">Writing inode tables: done</span><br><span class="line">Writing superblocks and filesystem accounting information: done</span><br></pre></td></tr></table></figure>
<h3 id="Mount-the-volume-to-a-filesystem"><a href="#Mount-the-volume-to-a-filesystem" class="headerlink" title="Mount the volume to a filesystem"></a>Mount the volume to a filesystem</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-172-31-90-214 ~]$ sudo mount /dev/xvdb /mnt</span><br><span class="line">sudo mount /dev/xvdb /mnt</span><br></pre></td></tr></table></figure>
<h3 id="Access-the-volume"><a href="#Access-the-volume" class="headerlink" title="Access the volume"></a>Access the volume</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-90-214 ec2-user]# cd /mnt</span><br></pre></td></tr></table></figure>
<h3 id="Umount-the-filesystem"><a href="#Umount-the-filesystem" class="headerlink" title="Umount the filesystem"></a>Umount the filesystem</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-90-214 /]# sudo umount /mnt</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/01/Upload-content-to-AWS-S3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yifan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/author.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Machine Learning and Data Science">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/01/Upload-content-to-AWS-S3/" itemprop="url">Upload content to S3 by awscli</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-01T14:55:56+12:00">
                2018-07-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AWS/" itemprop="url" rel="index">
                    <span itemprop="name">AWS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Create-access-keys"><a href="#Create-access-keys" class="headerlink" title="Create access keys"></a>Create access keys</h3><ol>
<li>Go to AWS Console -&gt; Security -&gt; IAM -&gt; Users</li>
<li>Select Security credentials tab and then choose Create access key</li>
</ol>
<h3 id="Configure-awscli"><a href="#Configure-awscli" class="headerlink" title="Configure awscli"></a>Configure awscli</h3><ol>
<li>Go to awscli</li>
<li>Run aws configure</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">aws configure</span><br><span class="line">AWS Access Key ID [None]: `&lt;your key&gt;`</span><br><span class="line">AWS Secret Access Key [None]: `&lt;your secret key&gt;`</span><br><span class="line">Default region name [None]: us-east-1</span><br><span class="line">Default output format [None]: json</span><br></pre></td></tr></table></figure>
<h3 id="Upload-a-single-file"><a href="#Upload-a-single-file" class="headerlink" title="Upload a single file"></a>Upload a single file</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws s3 cp `&lt;file name&gt;` s3://sesame-bucket-01/`&lt;file name&gt;`</span><br></pre></td></tr></table></figure>
<h3 id="Sync-a-fold"><a href="#Sync-a-fold" class="headerlink" title="Sync a fold"></a>Sync a fold</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws s3 sync `&lt;fold name&gt;` s3://sesame-bucket-01/`&lt;fold name&gt;`</span><br></pre></td></tr></table></figure>
<h3 id="List-S3-objects-under-a-S3-Bucket"><a href="#List-S3-objects-under-a-S3-Bucket" class="headerlink" title="List S3 objects under a S3 Bucket"></a>List S3 objects under a S3 Bucket</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws s3 ls s3://sesame-bucket-01 --recursive</span><br></pre></td></tr></table></figure>
<h3 id="Download-an-object-from-S3-to-EC2-instance"><a href="#Download-an-object-from-S3-to-EC2-instance" class="headerlink" title="Download an object from S3 to EC2 instance"></a>Download an object from S3 to EC2 instance</h3><ol>
<li>use awscli</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws s3 cp s3://sesame-bucket-01/thefile.txt .</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>use wget</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://sesame-bucket-01.s3.amazonaws.com/thefile.txt</span><br></pre></td></tr></table></figure>
<p>If you get the following 403 error, go to your bucket from the console, change the permission of the object to public.</p>
<p>HTTP request sent, awaiting response… 403 Forbidden<br>2018-07-02 04:49:15 ERROR 403: Forbidden.</p>
<h3 id="Download-a-fold-from-S3-to-EC2-instance"><a href="#Download-a-fold-from-S3-to-EC2-instance" class="headerlink" title="Download a fold from S3 to EC2 instance"></a>Download a fold from S3 to EC2 instance</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws s3 sync s3://sesame-bucket-01/files myfolder</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/04/Buckets-in-Hive/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yifan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/author.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Machine Learning and Data Science">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/04/Buckets-in-Hive/" itemprop="url">Buckets in Hive</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-04T22:28:15+12:00">
                2018-06-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Hadoop/" itemprop="url" rel="index">
                    <span itemprop="name">Hadoop</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Besides partition, the bucket is another technique to cluster datasets into more manageable parts to optimize query performance. By using buckets, an HiveQL query can easily and efficiently do sampling.</p>
<h3 id="Difference-between-partitions-and-buckets"><a href="#Difference-between-partitions-and-buckets" class="headerlink" title="Difference between partitions and buckets"></a>Difference between partitions and buckets</h3><ul>
<li>A partition corresponds to directories in HDFS. A bucket corresponds to segments of files in HDFS.</li>
<li>Partition columns don’t need to be actual table columns. Bucket columns have to be actual table data columns.</li>
</ul>
<h3 id="Create-a-table-with-bucket"><a href="#Create-a-table-with-bucket" class="headerlink" title="Create a table with bucket"></a>Create a table with bucket</h3><p>In the following example, we use employee_id as a bucket column. The records with the same employee_id will always be stored in the same bucket.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE employee_id_buckets (</span><br><span class="line">    name STRING,</span><br><span class="line">    employee_id INT  -- Use this table column as bucket column later</span><br><span class="line">    )</span><br><span class="line">    PARTITIONED BY (year INT, month INT) </span><br><span class="line">    CLUSTERED BY (employee_id) INTO 2 BUCKETS -- Support more columns</span><br><span class="line">    ROW FORMAT DELIMITED</span><br><span class="line">    FIELDS TERMINATED BY &apos;|&apos;;</span><br></pre></td></tr></table></figure></p>
<h3 id="Bucket-table-sampling"><a href="#Bucket-table-sampling" class="headerlink" title="Bucket table sampling"></a>Bucket table sampling</h3><ul>
<li>Sampling on the entire row</li>
</ul>
<p>rand() indicating entire row<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT name FROM employee</span><br><span class="line">TABLESAMPLE(BUCKET 1 OUT OF 2 ON rand()) a;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>Sampling on a specific column</li>
</ul>
<p>The colname can be one of the non-partition columns in the table.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT name FROM employee </span><br><span class="line">TABLESAMPLE(BUCKET 1 OUT OF 2 ON emp_id) e;</span><br></pre></td></tr></table></figure></p>
<p>In the above example, it means the 1st bucket out of the 2 buckets of the table source.<br>‘e’ is the table alias.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/author.gif"
                alt="Yifan Zhang" />
            
              <p class="site-author-name" itemprop="name">Yifan Zhang</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">26</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">25</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yifan Zhang</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
