<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Machine Learning and Data Science">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Machine Learning and Data Science">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Machine Learning and Data Science">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>Machine Learning and Data Science</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Machine Learning and Data Science</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/01/Processing-Json-and-XML-in-Hive/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yifan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/author.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Machine Learning and Data Science">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/01/Processing-Json-and-XML-in-Hive/" itemprop="url">Processing Json and XML in Hive</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-01T16:28:48+12:00">
                2018-06-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Hadoop/" itemprop="url" rel="index">
                    <span itemprop="name">Hadoop</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Regular-Expressions-in-Hive"><a href="#Regular-Expressions-in-Hive" class="headerlink" title="Regular Expressions in Hive"></a>Regular Expressions in Hive</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE EXTERNAL TABLE intermediate_access_logs (</span><br><span class="line">    code STRING,</span><br><span class="line">    name STRING,</span><br><span class="line">    method STRING)</span><br><span class="line">ROW FORMAT SERDE &apos;org.apache.hadoop.hive.contrib.serde2.RegexSerDe&apos;</span><br><span class="line">WITH SERDEPROPERTIES (</span><br><span class="line">    &apos;input.regex&apos; = &apos;&lt;regular expression&gt;&apos;,</span><br><span class="line">    &apos;output.format.string&apos; = &quot;%1$$s %2$$s %3$$s&quot;)</span><br><span class="line">LOCATION &apos;/user/hive/warehouse/logs&apos;;</span><br></pre></td></tr></table></figure>
<h3 id="Processing-Json-in-Hive"><a href="#Processing-Json-in-Hive" class="headerlink" title="Processing Json in Hive"></a>Processing Json in Hive</h3><ul>
<li><p>Prepare a JSON file</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat products.json</span><br><span class="line"></span><br><span class="line">&#123;&quot;name&quot;:&quot;iPhone 6&quot;, &quot;price&quot;: 600, &quot;category&quot; :&quot;phone&quot;, &quot;color&quot;: &quot;gold&quot;, &quot;stock&quot;: 10, &quot;tags&quot; : [&quot;phone&quot;, &quot;iphone&quot;, &quot;cell&quot;] &#125;</span><br><span class="line">&#123;&quot;name&quot;:&quot;iPhone 6 plus&quot;, &quot;price&quot;: 660, &quot;category&quot; :&quot;phone&quot;, &quot;color&quot;: &quot;silver&quot;, &quot;stock&quot;: 20, &quot;tags&quot; : [&quot;phone&quot;, &quot;iphone&quot;, &quot;cell&quot;] &#125;</span><br><span class="line">&#123;&quot;name&quot;:&quot;Samsung S6&quot;, &quot;price&quot;: 600, &quot;category&quot; :&quot;phone&quot;, &quot;color&quot;: &quot;white&quot;, &quot;stock&quot;: 10, &quot;tags&quot; : [&quot;phone&quot;, &quot;samsung&quot;, &quot;cell&quot;] &#125;</span><br><span class="line">&#123;&quot;name&quot;:&quot;Macbook Pro&quot;, &quot;price&quot;: 800, &quot;category&quot; :&quot;computer&quot;, &quot;color&quot;: &quot;silver&quot;, &quot;stock&quot;: 8, &quot;tags&quot; : [&quot;laptop&quot;, &quot;apple&quot;] &#125;</span><br><span class="line">&#123;&quot;name&quot;:&quot;Samsung Refrigerator 13 Ltr&quot;, &quot;price&quot;: 400, &quot;category&quot; :&quot;fridge&quot;, &quot;color&quot;: &quot;red&quot;, &quot;stock&quot;: 10, &quot;tags&quot; : [&quot;fridge&quot;, &quot;samsung&quot;] &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Copy the JSON file to HDFS</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -mkdir  /user/hive/warehouse/my_database.db/products</span><br><span class="line">hadoop fs -copyFromLocal products.json /user/hive/warehouse/my_database.db/products</span><br></pre></td></tr></table></figure>
</li>
<li><p>Connect to Hive</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">beeline -u &quot;jdbc:hive2://localhost:10000/default&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create a table</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE products_json (</span><br><span class="line">name STRING,</span><br><span class="line">price DOUBLE,</span><br><span class="line">category STRING,</span><br><span class="line">color STRING,</span><br><span class="line">stock INT,</span><br><span class="line">tags ARRAY&lt;STRING&gt;)</span><br><span class="line">ROW FORMAT SERDE &apos;org.apache.hive.hcatalog.data.JsonSerDe&apos;</span><br><span class="line">LOCATION &apos;/user/hive/warehouse/my_database.db/products&apos;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Verify records in the table </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">select * from products_json;</span><br><span class="line"></span><br><span class="line">+------------------------------+----------------------+-------------------------+----------------------+----------------------+-----------------------------+--+</span><br><span class="line">|      products_json.name      | products_json.price  | products_json.category  | products_json.color  | products_json.stock  |     products_json.tags      |</span><br><span class="line">+------------------------------+----------------------+-------------------------+----------------------+----------------------+-----------------------------+--+</span><br><span class="line">| iPhone 6                     | 600.0                | phone                   | gold                 | 10                   | [&quot;phone&quot;,&quot;iphone&quot;,&quot;cell&quot;]   |</span><br><span class="line">| iPhone 6 plus                | 660.0                | phone                   | silver               | 20                   | [&quot;phone&quot;,&quot;iphone&quot;,&quot;cell&quot;]   |</span><br><span class="line">| Samsung S6                   | 600.0                | phone                   | white                | 10                   | [&quot;phone&quot;,&quot;samsung&quot;,&quot;cell&quot;]  |</span><br><span class="line">| Macbook Pro                  | 800.0                | computer                | silver               | 8                    | [&quot;laptop&quot;,&quot;apple&quot;]          |</span><br><span class="line">| Samsung Refrigerator 13 Ltr  | 400.0                | fridge                  | red                  | 10                   | [&quot;fridge&quot;,&quot;samsung&quot;]        |</span><br><span class="line">+------------------------------+----------------------+-------------------------+----------------------+----------------------+-----------------------------+--+</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Processing-XML-in-Hive"><a href="#Processing-XML-in-Hive" class="headerlink" title="Processing XML in Hive"></a>Processing XML in Hive</h3><ul>
<li>Download XML SerDe</li>
</ul>
<p>Download URL: <a href="https://github.com/dvasilen/Hive-XML-SerDe" target="_blank" rel="noopener">XML SerDe</a></p>
<ul>
<li><p>Prepare a XML file</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;products&gt;</span><br><span class="line">    &lt;product id=&quot;1&quot;&gt;</span><br><span class="line">        &lt;name&gt;iPhone 6&lt;/name&gt;</span><br><span class="line">        &lt;category&gt;phone&lt;/category&gt;</span><br><span class="line">        &lt;price&gt;600&lt;/price&gt;</span><br><span class="line">        &lt;stock&gt;14&lt;/stock&gt;</span><br><span class="line">        &lt;features&gt;</span><br><span class="line">            &lt;storage&gt;64GB&lt;/storage&gt;</span><br><span class="line">            &lt;battery&gt;20Hrs&lt;/battery&gt;</span><br><span class="line">        &lt;/features&gt;</span><br><span class="line">    &lt;/product&gt;</span><br><span class="line">&lt;/products&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Copy the XML file to HDFS</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -copyFromLocal products.xml /user/hive/warehouse/my_database.db/products</span><br></pre></td></tr></table></figure>
</li>
<li><p>Connect to Hive</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">beeline -u &quot;jdbc:hive2://localhost:10000/default&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Add jar</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add jar /home/cloudera/Downloads/hivexmlserde-1.0.5.3.jar;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create a table</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE products_xml(</span><br><span class="line">id STRING, </span><br><span class="line">name STRING, </span><br><span class="line">category STRING,</span><br><span class="line">price DOUBLE,</span><br><span class="line">stock BIGINT,</span><br><span class="line">features map&lt;string,string&gt;)</span><br><span class="line">ROW FORMAT SERDE &apos;com.ibm.spss.hive.serde2.xml.XmlSerDe&apos;</span><br><span class="line">WITH SERDEPROPERTIES (</span><br><span class="line">&quot;column.xpath.id&quot;=&quot;/product/@id&quot;,</span><br><span class="line">&quot;column.xpath.name&quot;=&quot;/product/name/text()&quot;,</span><br><span class="line">&quot;column.xpath.category&quot;=&quot;/product/category/text()&quot;,</span><br><span class="line">&quot;column.xpath.price&quot;=&quot;/product/price/text()&quot;,</span><br><span class="line">&quot;column.xpath.stock&quot;=&quot;/product/stock/text()&quot;,</span><br><span class="line">&quot;column.xpath.features&quot;=&quot;/product/features/*&quot;</span><br><span class="line">)</span><br><span class="line">STORED AS</span><br><span class="line">INPUTFORMAT &apos;com.ibm.spss.hive.serde2.xml.XmlInputFormat&apos;</span><br><span class="line">OUTPUTFORMAT &apos;org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat&apos;</span><br><span class="line">TBLPROPERTIES (</span><br><span class="line">&quot;xmlinput.start&quot;=&quot;&lt;product id&quot;,</span><br><span class="line">&quot;xmlinput.end&quot;=&quot;&lt;/product&gt;&quot;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Load data</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOAD DATA INPATH &apos;/user/hive/warehouse/my_database.db/products/products.xml&apos; INTO TABLE products_xml;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Verify records in the table </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">select * from product_xml;</span><br><span class="line"></span><br><span class="line">+-----------------+-------------------+-----------------------+--------------------+--------------------+---------------------------------------+--+</span><br><span class="line">| product_xml.id  | product_xml.name  | product_xml.category  | product_xml.price  | product_xml.stock  |         product_xml.features          |</span><br><span class="line">+-----------------+-------------------+-----------------------+--------------------+--------------------+---------------------------------------+--+</span><br><span class="line">| 1               | iPhone 6          | phone                 | 600.0              | 14                 | &#123;&quot;battery&quot;:&quot;20Hrs&quot;,&quot;storage&quot;:&quot;64GB&quot;&#125;  |</span><br><span class="line">| 2               | iPhone 6 Plus     | phone                 | 800.0              | 15                 | &#123;&quot;battery&quot;:&quot;10Hrs&quot;,&quot;storage&quot;:&quot;64GB&quot;&#125;  |</span><br><span class="line">| 3               | Samsung S6        | phone                 | 650.0              | 12                 | &#123;&quot;battery&quot;:&quot;10Hrs&quot;,&quot;storage&quot;:&quot;16GB&quot;&#125;  |</span><br><span class="line">+-----------------+-------------------+-----------------------+--------------------+--------------------+---------------------------------------+--+</span><br></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/08/biglm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yifan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/author.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Machine Learning and Data Science">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/08/biglm/" itemprop="url">The biglm Package</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-08T23:26:57+13:00">
                2017-10-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Large-data/" itemprop="url" rel="index">
                    <span itemprop="name">Large data</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>The biglm package provides a way to fit linear regression models on data sets larger than memory. It fits the model sequentially on a subset of the data set (chunks) and updates the model at each step.</p>
<h3 id="Data-description"><a href="#Data-description" class="headerlink" title="Data description"></a>Data description</h3><p>I will use a subset of the Million Song Dataset from UCI machine learning database in the following address: <a href="https://archive.ics.uci.edu/ml/machine-learning-databases/00203/YearPredictionMSD.txt.zip" target="_blank" rel="noopener">https://archive.ics.uci.edu/ml/machine-learning-databases/00203/YearPredictionMSD.txt.zip</a> The task is to predict the release year of a song from audio features. Songs are mostly western, commercial tracks ranging from 1922 to 2011, with a peak in the year 2000s. The first column is the output and the remaining columns are the predictors.</p>
<h3 id="Read-the-data-and-save-it-to-a-local-CSV-file"><a href="#Read-the-data-and-save-it-to-a-local-CSV-file" class="headerlink" title="Read the data and save it to a local CSV file"></a>Read the data and save it to a local CSV file</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">library(biglm)</span><br><span class="line">library(data.table)</span><br><span class="line"></span><br><span class="line"># read the file into a data frame</span><br><span class="line">msd = fread(&quot;YearPredictionMSD.txt&quot;)</span><br><span class="line">dim(msd)</span><br></pre></td></tr></table></figure>
<p>[1] 515345     91</p>
<p>We can see that this is large data set with 515345 records.</p>
<h3 id="Split-to-the-training-set-and-the-test-set"><a href="#Split-to-the-training-set-and-the-test-set" class="headerlink" title="Split to the training set and the test set"></a>Split to the training set and the test set</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># split training dataset and testing dataset</span><br><span class="line">training = head(msd, 463715)</span><br><span class="line">testing = tail(msd, 51630)</span><br></pre></td></tr></table></figure>
<h3 id="Split-the-training-set-to-10-chunks"><a href="#Split-the-training-set-to-10-chunks" class="headerlink" title="Split the training set to 10 chunks"></a>Split the training set to 10 chunks</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># split training dataset into 10 chucks</span><br><span class="line">k = 10</span><br><span class="line">n = nrow(training)</span><br><span class="line">r = rep(1:k, each = ceiling(n/k))[1:n]</span><br><span class="line">chuck = split(training, r)</span><br></pre></td></tr></table></figure>
<h3 id="Fit-a-linear-model-using-biglm-chunk-by-chunk"><a href="#Fit-a-linear-model-using-biglm-chunk-by-chunk" class="headerlink" title="Fit a linear model using biglm chunk by chunk"></a>Fit a linear model using biglm chunk by chunk</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># fit the linear model</span><br><span class="line">colname = names(msd)</span><br><span class="line">fml = formula(paste(&quot;V1 ~&quot;, paste(colname[!colname %in% &quot;V1&quot;], collapse = &quot; + &quot;)))</span><br><span class="line">lmfit = biglm(fml, data = chuck[[1]])</span><br><span class="line"></span><br><span class="line">for(i in 2:k)&#123;</span><br><span class="line">  lmfit = update(lmfit, chuck[[i]])</span><br><span class="line">&#125;</span><br><span class="line">summary(lmfit)</span><br></pre></td></tr></table></figure>
<h3 id="Compute-the-mean-squared-prediction-error"><a href="#Compute-the-mean-squared-prediction-error" class="headerlink" title="Compute the mean squared prediction error"></a>Compute the mean squared prediction error</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># predict</span><br><span class="line">prediction = predict(lmfit, newdata = testing)</span><br><span class="line">actual = testing$V1</span><br><span class="line"># prediction error of testing set</span><br><span class="line">mean((prediction - actual)^2)</span><br></pre></td></tr></table></figure>
<p>[1] 90.44316</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/26/cvpe/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yifan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/author.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Machine Learning and Data Science">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/26/cvpe/" itemprop="url">Cross-Validation Prediction Error</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-26T18:26:57+13:00">
                2017-09-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Statistics/" itemprop="url" rel="index">
                    <span itemprop="name">Statistics</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>In cross validation, we split the data randomly into k parts, use one part for the test set and the remaining k-1 parts for the training set, and estimate the prediction error with the test set estimator. We repeat this process using a different kth as the test set each time. We average the resulting k prediction error estimates to get a final estimate. This is (k-fold) cross-validation. In practice we fix k=5 or 10.</p>
<p>In this post, I will use the abalone data set downloaded from UCI.</p>
<h3 id="Read-the-data-and-save-it-to-a-local-CSV-file"><a href="#Read-the-data-and-save-it-to-a-local-CSV-file" class="headerlink" title="Read the data and save it to a local CSV file"></a>Read the data and save it to a local CSV file</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">url = &quot;https://archive.ics.uci.edu/ml/machine-learning-databases/abalone/abalone.data&quot;</span><br><span class="line"></span><br><span class="line">abalone = read.csv(url, header = FALSE)</span><br><span class="line">names(abalone) = c(&quot;Sex&quot;, &quot;Length&quot;, &quot;Diameter&quot;, &quot;Height&quot;, &quot;Whole_weight&quot;,</span><br><span class="line">                   &quot;Shucked_weight&quot;, &quot;Viscera_weight&quot;, &quot;Shell_weight&quot;, &quot;Rings&quot;)</span><br><span class="line">write.csv(abalone, &quot;abalone.csv&quot;)</span><br><span class="line">dim(abalone)</span><br></pre></td></tr></table></figure>
<p>[1] 4177    9</p>
<h3 id="Fit-a-simple-linear-regression-model-and-compute-the-in-sample-prediction-error-PE"><a href="#Fit-a-simple-linear-regression-model-and-compute-the-in-sample-prediction-error-PE" class="headerlink" title="Fit a simple linear regression model and compute the in-sample prediction error (PE)"></a>Fit a simple linear regression model and compute the in-sample prediction error (PE)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lmfit = lm(Rings ~ ., data = abalone)</span><br><span class="line">pred = predict(lmfit, newdata = abalone)</span><br><span class="line"># mean squared predict error (in-sample)</span><br><span class="line">mean((abalone$Rings - pred)^2)</span><br></pre></td></tr></table></figure>
<p>[1] 4.802664</p>
<h3 id="10-fold-cross-validation-prediction-Error"><a href="#10-fold-cross-validation-prediction-Error" class="headerlink" title="10 fold cross-validation prediction Error"></a>10 fold cross-validation prediction Error</h3><p>The following code is used to compute the cross-validation mean squared prediction error (CVPE)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 10-fold cv</span><br><span class="line">k = 10</span><br><span class="line">shuffer = sample(nrow(abalone))</span><br><span class="line">chunk = nrow(abalone)/k</span><br><span class="line">cvpe = rep(0, k)</span><br><span class="line">for(i in 1:k)&#123;</span><br><span class="line">  testindex = shuffer[((i-1)*chunk+1):(i*chunk)]</span><br><span class="line">  test = abalone[testindex, ]</span><br><span class="line">  train = abalone[-testindex, ]</span><br><span class="line">  cvlm = lm(Rings ~ ., data = train)</span><br><span class="line">  testpred = predict(cvlm, newdata = test)</span><br><span class="line">  actual = test$Rings</span><br><span class="line">  cvpe[i] = mean((testpred - actual)^2)</span><br><span class="line">&#125;</span><br><span class="line">mean(cvpe)</span><br></pre></td></tr></table></figure>
<p>[1] 4.908085</p>
<p>We can see that the CVPE is larger than the PE, this is because we use the same data set to train and predict when computing the PE. The result is too optimistic. CVPE can correct the error by leaving out one chunk to act as the test data set.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/11/crossvm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yifan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/author.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Machine Learning and Data Science">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/11/crossvm/" itemprop="url">Running a Function on Cluster</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-11T12:34:39+12:00">
                2017-09-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Parallel-computing/" itemprop="url" rel="index">
                    <span itemprop="name">Parallel computing</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions:"></a>Functions:</h2><p>Functions: <code>makeCluster()</code>, <code>parLapply()</code></p>
<p>Package: <code>parallel</code></p>
<p>In this post, we aim at running the function fileStats() on multiple virtual machines with more cores via <code>makeCluster()</code>.</p>
<p>First, we take the virtual machine <code>vm01</code> as our master machine, and run <code>ssh-keygen</code> to generate key with empty passphrase. This step generates two files under the .ssh folder in user home directory.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls .ssh</span><br></pre></td></tr></table></figure>
<p>id_rsa  id_rsa.pub</p>
<p>Second, we use <code>ssh-copy-id</code> to copy the key to the other virtual machines.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id vm02</span><br></pre></td></tr></table></figure>
<p>Now, we can use <code>ssh</code> to login other virtual machines without providing username and password.</p>
<p>Also, we need to use <code>scp</code> to copy the R script which contains the function fileStats() to the other virtual machines, because they donâ€™t share the same file system.</p>
<p>To execute the code in parallel across multiple virtual machines, we use <code>makeCluster</code> to create 20 sessions on each of vm01 and vm02. Additionally, we use <code>clusterEvalQ</code> to load packages, variables and functions on each cluster node, because they are independent and communicate via sockets. At last, we use <code>stopCluster</code> to shutdown the cluster after completing the job. If it is not stopped, the processes continue to run in the background and consume resources, so new processes might be delayed.</p>
<p>If we want to compare this approach to the other two approaches described in the previous two posts, we  need to include the time to create and stop the cluster, as well as load the setup R script when timing this approach, because it is unfair if we just time the makeCluster or the parLapply call. The result indicates that it runs slower than the mclapply approach.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">library(parallel)</span><br><span class="line"># run on 2 VMs with 40 cores in parallel</span><br><span class="line">ptm.old &lt;- proc.time()</span><br><span class="line"># create cluster</span><br><span class="line">invisible(cluster &lt;- makeCluster(rep(c(&quot;vm01&quot;,</span><br><span class="line">                                       &quot;vm02&quot;), each = 20),</span><br><span class="line">                                 master = &quot;vm01&quot;,</span><br><span class="line">                                 user = &quot;&lt;username&gt;&quot;,</span><br><span class="line">                                 homogeneous = FALSE,</span><br><span class="line">                                 Rscript = &quot;/usr/bin/Rscript&quot;))</span><br><span class="line"></span><br><span class="line"># load the R script on each cluster node</span><br><span class="line">clusterEvalQ(cluster, source(&quot;./setup.R&quot;))</span><br><span class="line">allfilesCL &lt;- clusterApply(cluster, fileSizes$V2, fileStats)</span><br><span class="line"># shutdown cluster</span><br><span class="line">stopCluster(cluster)</span><br><span class="line">ptm.cl &lt;- proc.time() - ptm.old</span><br><span class="line">print(ptm.cl)</span><br></pre></td></tr></table></figure>
<p>user  system elapsed<br>17.228   4.786 268.946</p>
<p>Then, we try the <code>parLapply</code> approach. The result shows that the speed is faster than the clusterApply, and very close to the mclapply approach.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ptm.old &lt;- proc.time()</span><br><span class="line"># create cluster</span><br><span class="line">invisible(cluster &lt;- makeCluster(rep(c(&quot;vm01&quot;,</span><br><span class="line">                                       &quot;vm02&quot;), each = 20),</span><br><span class="line">                                 master = &quot;vm01&quot;,</span><br><span class="line">                                 user = &quot;&lt;username&gt;&quot;,</span><br><span class="line">                                 homogeneous = FALSE,</span><br><span class="line">                                 Rscript = &quot;/usr/bin/Rscript&quot;))</span><br><span class="line"># load the R script on each cluster node</span><br><span class="line">invisible(clusterEvalQ(cluster, source(&quot;./setup.R&quot;)))</span><br><span class="line">allfilesParL &lt;- parLapply(cluster, fileSizes$V2, fileStats)</span><br><span class="line"># shutdown cluster</span><br><span class="line">stopCluster(cluster)</span><br><span class="line">ptm.par &lt;- proc.time() - ptm.old</span><br><span class="line">print(ptm.par)</span><br></pre></td></tr></table></figure>
<p>user  system elapsed<br>0.540   0.209  25.791</p>
<p>The <code>clusterApply()</code> approach is slower than the standard <code>mclapply()</code> approach as there are additional communication overhead across the virtual machines. Also, the mclapply() approach creates new R sessions via forking, which is very fast. By contrast, <code>the clusterApply()</code> approach need to copy all the data via the sockets.</p>
<p>Although in both of <code>clusterApply()</code> and <code>parLapply()</code>, the nodes need to communicate via the sockets, <code>parLapply()</code> is still faster than  <code>clusterApply()</code>, because <code>clusterApply()</code> calls the function fileStats on the first node with the first element in fileSizes$V2, on the second node with the second element in fileSizes$V2, and so on. In the contrary, if we look at the definition of the function parLapply(), we can see that it is actually a wrapper of function <code>clusterApply()</code>, and the splitList(X, length(cl)) will split the tasks into even portions and send them to the nodes, which reduces the overhead of communication.</p>
<p>The speed of the <code>parLapply()</code> approach is very close to the <code>mclapply()</code>, but I think the individual running time of the single <code>parLapply()</code> call is faster, and the extra overhead via the sockets slows the overall speed down.</p>
<p>In conclusion, it is not always true that the more cores, the better the performance. We need to choose the approach on a case-by-case basis to prevent decreasing the computation speed.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/10/loadbalancing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yifan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/author.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Machine Learning and Data Science">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/10/loadbalancing/" itemprop="url">Load Balancing in R</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-10T17:20:56+12:00">
                2017-09-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Parallel-computing/" itemprop="url" rel="index">
                    <span itemprop="name">Parallel computing</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions:"></a>Functions:</h2><p>Functions: <code>mclapply()</code>, <code>proc.time()</code></p>
<p>Package: <code>parallel</code></p>
<p>Usually, when we process an amount of files, we will find that the size of some of the CSV files are larger than others, therefore, it take quite dissimilar amount of computation time. In order to balance the workload among all the sessions, we can rearrange the files by their sizes in decreasing order, in this way, R will run the larger files first. In addition, we set the parameter <code>mc.preschedule = FALSE</code>, so R will allocate the tasks to the slave sessions dynamically.</p>
<h3 id="The-parallel-approach-mclapply"><a href="#The-parallel-approach-mclapply" class="headerlink" title="The parallel approach mclapply()"></a>The parallel approach <code>mclapply()</code></h3><p>To compare the result, we first use the parallel approach <code>mclapply()</code> to apply the function fileStats() on the full set of CSV files, and then measure and save the time used by this approach for further comparison.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">library(parallel)</span><br><span class="line"># calculate time for the full set of CSV files using parallel processing</span><br><span class="line">ptm.old &lt;- proc.time()</span><br><span class="line">allfiles &lt;- mclapply(fileSizes$V2, fileStats, mc.cores = numCores)</span><br><span class="line">ptm.mc &lt;- proc.time() - ptm.old</span><br><span class="line">print(ptm.mc)</span><br></pre></td></tr></table></figure>
<p>user  system elapsed<br>420.805   5.757  25.068</p>
<h3 id="The-load-balance-approach"><a href="#The-load-balance-approach" class="headerlink" title="The load balance approach"></a>The load balance approach</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># reaggrange the files by size in decreasing order</span><br><span class="line">orderedFiles &lt;- fileSizes[order(fileSizes$V1, decreasing = TRUE), ]</span><br><span class="line">ptm.old &lt;- proc.time()</span><br><span class="line"># disable preschedule</span><br><span class="line">allfilesLB &lt;- mclapply(orderedFiles$V2, fileStats,</span><br><span class="line">                      mc.cores = numCores, mc.preschedule = FALSE)</span><br><span class="line">ptm.lb &lt;- proc.time() - ptm.old</span><br><span class="line">print(ptm.lb)</span><br></pre></td></tr></table></figure>
<p>user   system  elapsed<br>827.347 4959.750 1701.329</p>
<p>The result clearly indicates that load balancing does not reduce the time taken to perform the parallel computations on this data set. To investigate the reason, we enable the preschedule again, so the data is divided into 20 sections and passed to 20 processes.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ptm.old &lt;- proc.time()</span><br><span class="line">allfilesOrder &lt;- mclapply(orderedFiles$V2, fileStats, mc.cores = numCores)</span><br><span class="line">proc.time() - ptm.old</span><br></pre></td></tr></table></figure>
<p>user   system  elapsed<br>445.861   5.708  62.172</p>
<p>From the result we can observe that the standard approach with mc.preschedule = TRUE runs faster than the load balancing approach. This is because there are too many elements (98973) in the vector fileSizes$V1, and 98973 tasks need to be allocated to 20 nodes, so the number of tasks is almost 5000 times the number of nodes. This approach sends tasks one at a time to a node, and the communication overhead is very high. Therefore, I believe that the standard approach mc.preschedule = TRUE is better for short computations or vector with large length, and the load balancing approach mc.preschedule = FALSE is better for jobs that have high variance of computation time and not too many elements in the vector.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/09/parallel/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yifan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/author.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Machine Learning and Data Science">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/09/parallel/" itemprop="url">Serial vs. Parallel Processing</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-09T16:43:07+12:00">
                2017-09-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Parallel-computing/" itemprop="url" rel="index">
                    <span itemprop="name">Parallel computing</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions:"></a>Functions:</h2><p>Functions: <code>lapply()</code>, <code>system.time()</code>, <code>mclapply()</code>, <code>detectCores()</code>, <code>identical()</code></p>
<p>Package: <code>parallel</code></p>
<p>The goal of this post is to compare the speed between serial and parallel processing.</p>
<h3 id="Serial-processing"><a href="#Serial-processing" class="headerlink" title="Serial processing"></a>Serial processing</h3><p>In the serial processing part, we use the lapply() to apply the function <code>fileStats()</code> on each of the first 1000 CSV files. It returns a list object with length 1000. Also, we use <code>system.time()</code> to get how much CPU and real time the serial process has already taken.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># serial</span><br><span class="line">files &lt;- head(fileSizes, 1000)</span><br><span class="line">serial.time &lt;- system.time(serial &lt;- lapply(files$V2, fileStats))</span><br><span class="line">class(serial)</span><br></pre></td></tr></table></figure>
<p>[1] â€œlistâ€</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">length(serial)</span><br></pre></td></tr></table></figure>
<p>[1] 1000</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(serial.time)</span><br></pre></td></tr></table></figure>
<p>user  system elapsed<br>3.585   0.080   3.668</p>
<h3 id="Parallel-processing"><a href="#Parallel-processing" class="headerlink" title="Parallel processing"></a>Parallel processing</h3><p>In this part, we use <code>detectCores()</code> in the <code>parallel</code> package to detect the number of cores in the Linux virtual machine, and the result shows that there are 20 cores in the VM.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">library(parallel)</span><br><span class="line"># detect cores</span><br><span class="line">numCores &lt;- detectCores()</span><br><span class="line">print(numCores)</span><br></pre></td></tr></table></figure>
<p>[1] 20</p>
<p>After that, we use <code>mclapply()</code> to run the function fileStats() on all of the 20 cores in parallel at once. The slave R sessions can recognize the fileStats() function because of the forked R sessions, so the variables and functions are shared between these sessions.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># run in parallel</span><br><span class="line">par.time &lt;- system.time(parallel &lt;- mclapply(files$V2, fileStats, mc.cores = numCores))</span><br><span class="line">class(parallel)</span><br></pre></td></tr></table></figure>
<p>[1] â€œlistâ€</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">length(parallel)</span><br></pre></td></tr></table></figure>
<p>[1] 1000</p>
<p>Similar to the serial processing, it also returns a list object with length 1000.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(par.time)</span><br></pre></td></tr></table></figure>
<p>user  system elapsed<br>4.318   0.684   0.378</p>
<p>To compare the answers, we use <code>identical()</code> to test whether the whole outputs are equal, and it returns TRUE, which means that the two objects are exactly the same. Furthermore, we notice that the user time exceeds the elapsed time, and that is the sign of working in parallel.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># check whether the answers are the same</span><br><span class="line">identical(serial, parallel)</span><br></pre></td></tr></table></figure>
<p>[1] TRUE</p>
<figure class="highlight plain"><figcaption><span>comparing time&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Times faster</span><br><span class="line">serial.time[3]/par.time[3]</span><br></pre></td></tr></table></figure>
<p>elapsed<br>9.703704</p>
<p>From the user CPU and real time, we can see that parallel processing is about 10 times faster than serial processing instead of 20 times. There are two main reasons for this result. First, there is overhead in starting up slave R sessions. Second, there is some communication overhead between the master and slave sessions, because these slave sessions need to send the results back to the master after executing the function.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/16/rsqlite/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yifan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/author.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Machine Learning and Data Science">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/16/rsqlite/" itemprop="url">The RSQLite Package</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-16T16:43:07+12:00">
                2017-08-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Large-data/" itemprop="url" rel="index">
                    <span itemprop="name">Large data</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions:"></a>Functions:</h2><p>Functions: <code>dbConnect()</code>, <code>dbGetQuery()</code><br>Package: <code>RSQLite</code></p>
<p>In the previous post, we use the <code>data.table</code> package to read, add and aggregate the data, and we found that it is faster and use less RAM than the stardard R functions. Today, we will repeat the steps using the â€˜RSQLiteâ€™ package.</p>
<p>We will find dramatically less memory usage by R, because all of the calculations are happen in SQLite, rather in R.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">library(RSQLite)</span><br><span class="line"></span><br><span class="line">gc(reset=TRUE)</span><br><span class="line">db = dbConnect(SQLite(), db=&quot;alldata.sqlite&quot;)</span><br><span class="line">gc()</span><br><span class="line"></span><br><span class="line">gc(reset=TRUE)</span><br><span class="line">arrivals = dbGetQuery(db, &quot;SELECT AVG(arrival), strftime(&apos;%w&apos;, timestamp, &apos;unixepoch&apos;, &apos;localtime&apos;) as wday FROM buses WHERE arrival != &apos;NA&apos; GROUP BY wday&quot;)</span><br><span class="line">departures = dbGetQuery(db, &quot;SELECT AVG(departure), strftime(&apos;%w&apos;, timestamp, &apos;unixepoch&apos;, &apos;localtime&apos;) as wday FROM buses WHERE departure != &apos;NA&apos; GROUP BY wday&quot;)</span><br><span class="line">merge(arrivals, departures)</span><br><span class="line">gc()</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/15/largedata/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yifan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/author.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Machine Learning and Data Science">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/15/largedata/" itemprop="url">The data.table Package</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-15T14:22:10+12:00">
                2017-08-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Large-data/" itemprop="url" rel="index">
                    <span itemprop="name">Large data</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions:"></a>Functions:</h2><p>Functions: <code>fread()</code>, â€œ:=â€, <code>gc()</code>, <code>rm()</code><br>Package: <code>data.table</code></p>
<p>The <code>data.table</code> package can be used to reduce the amount of copying that R does, thus, it can save memory resources.</p>
<p>The following code use this package to measure the memory used by R for each of the below steps.</p>
<ol>
<li>Read the file into R</li>
<li>Add a day-of-week column</li>
<li>Aggregate arrival and departure delays by day-of-week</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">library(data.table)</span><br><span class="line"># read</span><br><span class="line">gc(reset=TRUE)</span><br><span class="line">bus = fread(&quot;alldata.csv&quot;)</span><br><span class="line">gc()</span><br><span class="line"></span><br><span class="line"># fast add a new column wday(day of week)</span><br><span class="line">gc(reset=TRUE)</span><br><span class="line">bus[,</span><br><span class="line">      wday := as.POSIXlt(timestamp,</span><br><span class="line">                         origin=as.Date(&quot;1970-01-01&quot;))$wday]</span><br><span class="line">gc()</span><br><span class="line"></span><br><span class="line"># aggregate arrival and departure delays by day-of-week</span><br><span class="line">gc(reset=TRUE)</span><br><span class="line">bus[,</span><br><span class="line">    .(avgArr = mean(arrival, na.rm=TRUE),</span><br><span class="line">      avgDep = mean(departure, na.rm=TRUE)),</span><br><span class="line">    by=.(wday)]</span><br><span class="line">gc()      </span><br><span class="line">gc(reset=TRUE)</span><br><span class="line"></span><br><span class="line"># Clean up</span><br><span class="line">rm(bus)</span><br><span class="line">gc(reset=TRUE)</span><br></pre></td></tr></table></figure>
<p>This method is more efficiency and use less RAM than the standard R functions (e.g., read.csv() and aggregate()).</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/14/estimateram/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yifan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/author.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Machine Learning and Data Science">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/14/estimateram/" itemprop="url">Estimate Memory Size of a Large File</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-14T12:50:07+12:00">
                2017-08-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Large-data/" itemprop="url" rel="index">
                    <span itemprop="name">Large data</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions:"></a>Functions:</h2><p>Functions: <code>objext.size()</code></p>
<p>We know that R stores all the data in RAM, it automatically allocates memory as required. Before we load a very large dataset into R, we need to estimate how much memory the complete file will take up once it is loaded. Today, I will examine two methods to estimate , WITHOUT reading the entire file.</p>
<h3 id="Method-One"><a href="#Method-One" class="headerlink" title="Method One"></a>Method One</h3><p>We find the size of a subset of the dataset and then scale up the result to make an estimate. The following code only read the first 1000 lines in the data set, rather than all of them. Then we get the total number of lines of the file to calculate our first estimate.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># read the first 1000 lines</span><br><span class="line">atpart = read.csv(&quot;alldata.csv&quot;, nrow = 1000)</span><br><span class="line">partsize = object.size(atpart)</span><br><span class="line"></span><br><span class="line"># number of lines in the complete file</span><br><span class="line">nline = as.integer(system(&quot;wc -l alldata.csv | awk -e &apos;&#123;print($1)&#125;&apos;&quot;,</span><br><span class="line">                          intern = TRUE))</span><br><span class="line"></span><br><span class="line"># estimate in MB                          </span><br><span class="line">estimate1 = partsize*nline/1000</span><br><span class="line">print(partsize*nline/1000, units = &quot;Mb&quot;)</span><br></pre></td></tr></table></figure>
<h3 id="Method-Two"><a href="#Method-Two" class="headerlink" title="Method Two"></a>Method Two</h3><p>The second approach examines the types of variables in the dataset to take into account the different memory demands of numeric and character vectors.</p>
<p>The following code will summary the type of each column in the data frame</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Type of vectors</span><br><span class="line">sapply(atpart, class)</span><br><span class="line">table(sapply(atpart, class))</span><br></pre></td></tr></table></figure>
<p>Assume that it consists of 3 factor variables and 5 integer variables, then our estimate will be the sum of four components:</p>
<p>1) overhead: Each of the eight vectors, regardless of type, will has an overhead of around 40 bytes.<br>2) integer vectors: integer values require 4 bytes<br>3) character vectors: character values require 8 bytes<br>4) cache size. We use the sample of the first 1000 rows to estimate the number of levels in each of the factors. Assume that the strings of each factor are of fixed lengths. Hence obtaining the character length of the first level will be sufficient for determining the lengths of all unique levels.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CacheSize = function(x) &#123;</span><br><span class="line">  lev = levels(x)</span><br><span class="line">  # assume all levels are the same length</span><br><span class="line">  cache.size = length(lev)*nchar(lev[1])</span><br><span class="line">&#125;</span><br><span class="line">Cache = do.call(rbind.data.frame, lapply(atpart[, 1:3], CacheSize))</span><br><span class="line"></span><br><span class="line">Our second estimate is:</span><br><span class="line"></span><br><span class="line">```&#123;r&#125;</span><br><span class="line">estimate2 = 8*40 + 5*4*nline + 3*8*nline + sum(Cache)</span><br><span class="line">paste(as.numeric(estimate2), &quot;Mb&quot;)</span><br></pre></td></tr></table></figure>
<p>In summary, the first approach produces a fast estimate, while the second approach requires more calculation but will be closer to the actual file size. Both approaches assume the complexity and structure of the lines in the dataset remain consistent.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/12/unixshell/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yifan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/author.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Machine Learning and Data Science">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/12/unixshell/" itemprop="url">Run Unix Shell Command in R</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-12T12:50:07+12:00">
                2017-08-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions:"></a>Functions:</h2><p>Functions: <code>system()</code>, <code>strptime()</code>, <code>gsub()</code>,</p>
<h3 id="Determine-the-number-of-files-in-the-a-directory-in-Unix"><a href="#Determine-the-number-of-files-in-the-a-directory-in-Unix" class="headerlink" title="Determine the number of files in the a directory in Unix"></a>Determine the number of files in the a directory in Unix</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">numFiles &lt;- system(&quot;ls -1 &lt;your path&gt; | wc -l&quot;, intern=TRUE)</span><br><span class="line">cat(numFiles)</span><br></pre></td></tr></table></figure>
<p>98973</p>
<h3 id="Extracting-the-file-sizes"><a href="#Extracting-the-file-sizes" class="headerlink" title="Extracting the file sizes"></a>Extracting the file sizes</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">system(&quot;ls -l &lt;your path&gt; | awk -e &apos;&#123;print($5)&#125;&apos; &gt; sizes.txt&quot;)</span><br><span class="line">system(&quot;head sizes.txt&quot;)</span><br><span class="line">size = read.table(&quot;sizes.txt&quot;)</span><br></pre></td></tr></table></figure>
<p>There are 98973 csv files in this directory, containing information on Auckland Bus delays. The file name contains a date-time component that reflects the exact time of the request for each file. For example: trip_updates_20170401050001.csv.</p>
<h3 id="Convert-character-to-date-and-time"><a href="#Convert-character-to-date-and-time" class="headerlink" title="Convert character to date and time"></a>Convert character to date and time</h3><p>The following code will convert string 20170401050001 to Date: 2017-04-01 and Time: 05:00:01<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">datetime =  strptime(gsub(&quot;[^[:digit:]]&quot;, &quot;&quot;, size.time$date),</span><br><span class="line">                     &quot;%Y%m%d%H%M%S&quot;)</span><br><span class="line">size.time$date = as.Date(datetime)</span><br><span class="line">size.time$time = strftime(datetime, format=&quot;%H:%M:%S&quot;)</span><br></pre></td></tr></table></figure></p>
<h3 id="Extracting-trips-made-by-vehicle-6215-on-the-1st-April-2017"><a href="#Extracting-trips-made-by-vehicle-6215-on-the-1st-April-2017" class="headerlink" title="Extracting trips made by vehicle 6215 on the 1st April 2017"></a>Extracting trips made by vehicle 6215 on the 1st April 2017</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">system(&quot;grep -h ,6215, &lt;your path&gt;/trip_updates_20170401* &gt; bus-6215-2017-04-01.csv&quot;)</span><br><span class="line">busLines &lt;- system(&quot;head bus-6215-2017-04-01.csv&quot;, intern=TRUE)</span><br><span class="line">cat(busLines, sep=&quot;\n&quot;)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/author.gif"
                alt="Yifan Zhang" />
            
              <p class="site-author-name" itemprop="name">Yifan Zhang</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">24</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">25</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yifan Zhang</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
